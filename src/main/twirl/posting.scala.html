@(topicID: String)

<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
        <title>
            @topicID match {
                case "" => {
                    Topics
                }
                case id => {
                    Answers
                }
            }
        </title>
    </head>
    <body>
        <header class="topbar">
            <h1 class="fill" id="header-title">
                <a href="http://localhost:9000">
                    Akka HTTP - Forum Template
                </a>
            </h1>
        </header>

        <div class="container">
            @topicID match {
                case "" => {
                    <h2>New topic</h2>
                }
                case id => {
                    <h2>New answer</h2>
                }
            }

            <p>Create new topic by filling form below</p>
            <form>
                <div class="form-group">
                    <label for="nickname">Nickname:</label>
                    <input type="text" class="form-control" id="nickname">
                </div>
                <div class="form-group">
                    <label for="email">Email:</label>
                    <input type="email" class="form-control" id="email">
                </div>
                <div class="form-group">
                    <label for="subject">Subject:</label>
                    <input type="text" class="form-control" id="subject">
                </div>
                <div class="form-group">
                    <label for="content">Content:</label>
                    <input type="text" class="form-control" id="content">
                </div>
            </form>
        </div>

        <button type="button" class="btn btn-success" onclick="send_request()">Submit</button>

            <!-- Modal -->
        <div id="myModal" class="modal fade" role="dialog">
            <div class="modal-dialog">

                    <!-- Modal content-->
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                        <h4 class="modal-title" id="label"></h4>
                    </div>
                    <div class="modal-body">
                        <p id="msg"></p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" id="cancel" data-dismiss="modal">Close</button>
                    </div>
                </div>

            </div>
        </div>

        <script>
                function form_to_json() {
                    var a = document.getElementById("nickname").value;
                    var b = document.getElementById("email").value;
                    var c = document.getElementById("subject").value;
                    var d = document.getElementById("content").value;
                    var json = `{"user":{"nick":"${a}","email":"${b}"},"subject":"${c}","content":"${d}"}`;
                    return json
                }

                function send_request() {

                    var routing;
                    @topicID match {
                        case "" => {
                            routing = "topics";
                        }
                        case id => {
                            routing = "topics/" + @id +"/answers";
                        }
                    }


                    var xhr = new XMLHttpRequest();
                    xhr.open('POST', 'http://localhost:9000/' + routing, true);
                    xhr.setRequestHeader("Content-Type", "application/json");
                    xhr.onreadystatechange = function () {
                        if (xhr.readyState === 4 && xhr.status === 201) {
                            document.getElementById('label').innerText = 'Your secret';
                            document.getElementById('msg').innerText = xhr.responseText;
                            document.getElementById('cancel').addEventListener('click', function(){
                                window.location.href = "http://localhost:9000/topics";
                            });
                            $('#myModal').modal('show');
                        } else if(xhr.status === 401) {
                            document.getElementById('label').innerText = 'Invalid input';
                            document.getElementById('msg').innerText = xhr.responseText;
                            $('#myModal').modal('show');
                        } else {
                            document.getElementById('label').innerText = 'Internal error';
                            document.getElementById('msg').innerText = xhr.responseText;
                            $('#myModal').modal('show');
                        }
                    };
                    xhr.send(form_to_json());
                }
        </script>
    </body>
</html>